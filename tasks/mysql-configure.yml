---

- name: Check all processes
  ansible.builtin.command: ps aux
  changed_when: false
  failed_when: false
  register: psa
- name: Debug | ps aux output
  ansible.builtin.debug:
    var: psa
    verbosity: 1
- name: Check for mysql sockets
  ansible.builtin.command:
    cmd: ls -l /var/run/mysqld
  changed_when: false
  failed_when: false

- name: Ubuntu - login
  ansible.builtin.import_tasks: mysql-configure-login.yml
  when:
    - ansible_distribution == 'Ubuntu'

- name: Non-Ubuntu - socket
  ansible.builtin.import_tasks: mysql-configure-socket.yml
  when:
    - ansible_distribution != 'Ubuntu'

- name: Ubuntu xenial
  when: ansible_distribution_release == 'xenial'
  block:
    - name: Temporary workaround - mysql57 disable strict mode
      ansible.builtin.copy:
        src: disable_strict_mode.cnf
        dest: /etc/mysql/conf.d/disable_strict_mode.cnf
        mode: '0644'
      notify:
        - Restart mysql
